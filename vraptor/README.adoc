//caminho padrão para imagens
:imagesdir: ../images
:figure-caption: Figura
:doctype: book

//gera apresentacao
//pode se baixar os arquivos e add no diretório
:revealjsdir: https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0

//GERAR ARQUIVOS
//make slides
//make ebook

//Estilo do Sumário
:toc2: 
//após os : insere o texto que deseja ser visível
:toc-title: Sumário
:figure-caption: Figura
//numerar titulos
:numbered:
:source-highlighter: highlightjs
:icons: font
:chapter-label:
:doctype: book
:lang: pt-BR
//3+| mesclar linha tabela

link:https://fagno.github.io/pwebii-ifto/[HOME]

= Programação para Web II
Fagno Alves Fonseca <fagno.fonseca@ifto.edu.br>
Mestre em Modelagem Computacional de Sistemas – UFT.

== Vraptor

O VRaptor É um framework MVC opensource que traz alta produtividade para um desenvolvimento Java Web rápido e fácil com CDI. 

=== Depedência

Para adicionar o Vraptor no seu projeto web com maven é necessário incluir a depência do framework atualmente em na versão 4 conforme a seguir.

.Dependência do Vraptor 4
[source, xml]
----
<dependency>
    <groupId>br.com.caelum</groupId>
    <artifactId>vraptor</artifactId>
    <version>4.2.0-RC5</version>
</dependency>
----

Na link:http://www.vraptor.org/pt/docs/dependencias-e-pre-requisitos/[documentação] do Vraptor indica que os Servidores de Aplicações já testados e suportados são Glassfish 4 e 
WildFly 8. Em nossos exemplos vamos utilizar o Glassfish 4.

IMPORTANT: É necessário alterar a versão da dependência do Guava.jar na servidor Glassfish.

Para alterar a versão da dependência do Guava no servidor Glassfish, acesse o diretório do mesmo em glassfish4/glassfish/modules. Você deve excluir o arquivo existente do Guava e adicionar a mesma versão utilizada pelo Vraptor, disponível link:https://github.com/fagno/pwebii-ifto/raw/master/arquivos/guava-15.0.jar/[aqui].

=== Definindo um Controller

Controller são classes contendo a lógica de negócio do seu sistema. É responsável por receber todas as requisições do usuário. Uma camada intermediária entre a camada de apresentação e a lógica.

Imagine que temos uma classe Pessoa, deste modo, vamos criar uma nova classe para representar o Controller e tratar as requisições web. Essa classe vai ser o Controller de pessoas. 

A nova classe deve ser definida com o nome PessoasController. Para indicar que uma classe é um controller, você precisa anotá-la com a anotação @Controller conforme o exemplo a seguir.

.Criando um Controller
[source, java]
----
import br.com.caelum.vraptor.Controller;

@Controller
public class PessoasController{
    ...
} 
----

Anotando seu controller com @Controller, todos os seus métodos públicos serão acessíveis pela web. No exemplo a seguir, uma requisição à URI "http://localhost:8080/projetoexemplo/pessoas/lista" redirecionará para o método lista(). Ou seja, a convenção para a criação de URIs é /<nome_do_controller>/<nome_do_metodo>. 

.PessoasController
[source, java]
----
package com.mycompany.projetoexemplo.controller;

import br.com.caelum.vraptor.Controller;
import com.mycompany.projetoexemplo.model.Pessoa;
import java.util.ArrayList;
import java.util.List;

@Controller
public class PessoasController {

    public List<Pessoa> lista(){
        List<Pessoa> pessoas = new ArrayList();
        pessoas.add(new Pessoa("Pessoa 1"));
        pessoas.add(new Pessoa("Pessoa 2"));
        return pessoas;
    }    

}
----

Ao terminar a execução do método, o VRaptor fará o dispatch da requisição para o JSP no diretório do seu projeto em /WEB-INF/jsp/pessoas/lista.jsp. Ou seja, a convenção para a view padrão é /WEB-INF/jsp/<nome_do_controller>/<nome_do_metodo>.jsp conforme figura a seguir.

.Conversão para a view
image::vraptor-web-inf.png/[]

Ao executar o projeto acima, a saída será a lista de pessoas conforme definido no projeto.

Outro exemplo que podemos definir é o método form(). Ao adicionar o método no controller conforme o exemplo a seguir, e criar o form.jsp em /WEB-INF/jsp/pessoas/form.jsp assim como feito com o lista.jsp na figura 1, podemos acessar o formulário através da URI "http://localhost:8080/projetoexemplo/pessoas/form".

.PessoasController
[source, java]
----
...
    public void form(){
    }
...
----

Para visualizar a lista de pessoas através da requisição à URI "http://localhost:8080/projetoexemplo/pessoas/lista" você deve definiar seu arquivo lista.jsp conforme a seguir.

.lista.jsp
[source, xml]
----
...
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Lista de Pessoas</title>
</head>
<body>
    <c:forEach items="${pessoaList}" var="pessoa">
        ${pessoa.nome} 
    </c:forEach>
</body>
...
----

O retorno dos métodos do controller são exportados para a view. Descrevo dois pontos importantes que precisam ser destados.

IMPORTANT: No caso do nosso método lista(), o retorno é uma lista de pessoas, sendo assim, a variável acessível no jsp será ${pessoaLista}.

IMPORTANT: Se o retorno for um tipo simples, o nome da variável exportada será o nome da classe com a primeira letra minúscula, neste caso, a variável na jsp será ${pessoa}. 

== Referências

1. http://www.vraptor.org/pt/docs/guia-de-1-minuto/